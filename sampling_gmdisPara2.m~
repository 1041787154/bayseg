function [mu,SIGMA,beta]=sampling_gmdisPara2(Element,MID_list,Mset,T,y,mu,SIGMA,beta,prior_para)
% mu is n_Mset by d
% SIGMA is d by d by k

SigmaProp = diag(0.01*ones(length(beta),1));

num_of_ele=length(Element.Color);
n_Mset=size(mu,1);
d=size(mu,2);

%===== constract proposal function ===============    
beta_star = mvnrnd(beta',SigmaProp)';

mu_star=zeros(n_Mset,d);
SIGMA_star=zeros(d,d,n_Mset);
sigma_jump(1,d,2) = 0;
sigma_jump(:,:,1) = 0.0005*ones(1,d);
sigma_jump(:,:,2) = 0.00005*ones(1,d);
Combinations = nchoosek(1:d,2);
n_axis = size(Combinations,1);

parfor i=1:n_Mset     
    R = mvnrnd(zeros(1,d),sigma_jump);
    jump_mu = R(1,:);
    jump_logD = R(2,:);
    jump_theta = mvnrnd(zeros(1,n_axis),0.005*ones(1,n_axis));
    
    mu_star(i,:)=mu(i,:)+jump_mu;
    
    [V,D]=eig(SIGMA(:,:,i));    
    D_star = diag(exp(log(diag(D))+jump_logD'));
    
    A = eye(d);
    for j=1:n_axis
        Rotation_Matrix = rotation(V(:,Combinations(j,1)),V(:,Combinations(j,2)),jump_theta(j));
        A = Rotation_Matrix*A;
    end
    V_star = A*V;
    
    SIGMA_star(:,:,i)=V_star*D_star*V_star';
end

%===== calsulate mixing parameters P ===================
P=zeros(num_of_ele,n_Mset);
P_star = zeros(num_of_ele,n_Mset);
SU = Element.SelfU;
parfor idx=1:num_of_ele
    if ~isnan(MID_list(idx))
        U=SU(idx,:); % assign the energy of sigle site clique
        U_star = SU(idx,:);
        n_neighbor=size(Element(idx).Neighbors,1);
        M_center = ones(n_neighbor,1)*Mset;
        M_neighbor = MID_list(Element(idx).Neighbors)*ones(1,n_Mset);
        is_zero = (M_center==M_neighbor) | isnan(M_neighbor);
        M_beta = Element(idx).Direction*beta*ones(1,n_Mset); % beta is n_direction-by-1 vector.
        M_beta_star = Element(idx).Direction*beta_star*ones(1,n_Mset); % beta_star is n_direction-by-1 vector.
        M_beta(is_zero) = 0;
        M_beta_star(is_zero) = 0;
        U = U + sum(M_beta);
        U_star = U_star + sum(M_beta_star);
        P(idx,:)=exp(-U/T)/sum(exp(-U/T));
        P_star(idx,:) = exp(-U_star/T)/sum(exp(-U_star/T));
    end    
end
%===================================================================
for i=1:n_Mset
    mu_cadidate=mu;
    mu_cadidate(i,:)=mu_star(i,:);
    [mu,SIGMA,beta]=rejectDisPara(num_of_ele,d,n_Mset,y,P,P,mu,mu_cadidate,SIGMA,SIGMA,beta,beta,prior_para);
end

for i=1:n_Mset
    SIGMA_cadidate=SIGMA;
    SIGMA_cadidate(:,:,i)=SIGMA_star(:,:,i);
    [mu,SIGMA,beta]=rejectDisPara(num_of_ele,d,n_Mset,y,P,P,mu,mu,SIGMA,SIGMA_cadidate,beta,beta,prior_para);
end

[mu,SIGMA,beta]=rejectDisPara(num_of_ele,d,n_Mset,y,P,P_star,mu,mu,SIGMA,SIGMA,beta,beta_star,prior_para);

end